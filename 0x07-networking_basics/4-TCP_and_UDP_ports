#!/usr/bin/env bash
# This script displays listening ports along with PID and program name.

# Display active internet connections with listening sockets
echo "Active Internet connections (only servers)"
echo "Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name"

# Display listening TCP ports
netstat -tln | awk '/tcp/ {print $1, $4, $NF}' | sed -e '1d' | while read proto local foreign state; do
    pid=$(lsof -i -n -P | grep "$local" | awk '{print $2}')
    pname=$(ps -p $pid -o comm=)
    echo "$proto    -      -    $local                  $foreign                 $state       $pid/$pname"
done

# Display listening UDP ports
netstat -uln | awk '/udp/ {print $1, $4, $NF}' | sed -e '1d' | while read proto local foreign state; do
    pid=$(lsof -i -n -P | grep "$local" | awk '{print $2}')
    pname=$(ps -p $pid -o comm=)
    echo "$proto    -      -    $local                  $foreign                 $state       $pid/$pname"
done
